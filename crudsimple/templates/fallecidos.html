{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci贸n</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Font Awesome para los 铆conos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

</head>

<body>
    {% include "includes/logout.html" %}

    <div class="container">
        <br>
        <h1 class="text-center mb-4" style="padding-left: 30%;">拆拣金 叼叼拆葛</h1>


        <form method="get" action="{% url 'listadoFallecidos' %}" class="mb-4">
            <div class="row g-3">
                <!-- Filtros de texto -->
                <div class="col-md-3">
                    <input type="text" name="rut" class="form-control campo-input" placeholder="Rut"
                        value="{{ request.GET.rut|default_if_none:'' }}">
                </div>
                <div class="col-md-3">
                    <input type="text" name="nombre" class="form-control campo-input" placeholder="Nombre"
                        value="{{ request.GET.nombre|default_if_none:'' }}">
                </div>
                <div class="col-md-3">
                    <input type="text" name="apellido_p" class="form-control campo-input"
                        value="{{ request.GET.apellido_p|default_if_none:'' }}" placeholder="Apellido Paterno">
                </div>
                <div class="col-md-3">
                    <input type="text" name="apellido_m" class="form-control campo-input"
                        value="{{ request.GET.apellido_m|default_if_none:'' }}" placeholder="Apellido Materno">
                </div>

                <!-- Filtros de fecha -->
                <div class="col-md-3">
                    <input type="date" name="fecha_inicio" class="form-control campo-input"
                        value="{{ request.GET.fecha_inicio|default_if_none:'' }}">
                </div>
                <div class="col-md-3">
                    <input type="date" name="fecha_fin" class="form-control campo-input"
                        value="{{ request.GET.fecha_fin|default_if_none:'' }}">
                </div>

                <!-- Filtro de Ubicaci贸n -->
                <div class="col-md-3">
                    <select name="ubicacion" class="form-control campo-input">
                        <option value="">Seleccione una ubicaci贸n</option>
                        {% if request.GET.ubicacion == "sotano" %}
                        <option value="sotano" selected>S贸tano</option>
                        {% else %}
                        <option value="sotano">S贸tano</option>
                        {% endif %}

                        {% if request.GET.ubicacion == "bloque_1" %}
                        <option value="bloque_1" selected>Bloque 1</option>
                        {% else %}
                        <option value="bloque_1">Bloque 1</option>
                        {% endif %}

                        {% if request.GET.ubicacion == "bloque_2" %}
                        <option value="bloque_2" selected>Bloque 2</option>
                        {% else %}
                        <option value="bloque_2">Bloque 2</option>
                        {% endif %}

                        {% if request.GET.ubicacion == "miramar" %}
                        <option value="miramar" selected>Miramar</option>
                        {% else %}
                        <option value="miramar">Miramar</option>
                        {% endif %}
                    </select>
                </div>
                <!-- Bot贸n de filtro -->
                <div class="col-md-3 d-grid">
                    <div class="btn-group" role="group" style="width: 100%;">
                        <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Filtrar</button>
                        <a href="{% url 'listadoFallecidos' %}" class="btn btn-secondary"><i class="fas fa-times"></i>
                            Limpiar</a>
                    </div>
                </div>
            </div>
        </form>

        <!-- Mensajes de alerta -->
        {% if messages %}
        <div id="message-container">
            {% for message in messages %}
            <div class="alert {% if message.tags %}alert-{{ message.tags|cut:'safe' }}{% else %}alert-info{% endif %} alert-dismissible fade show"
                role="alert">
                {% if 'safe' in message.tags %}
                {{ message|safe }}
                {% else %}
                {{ message }}
                {% endif %}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Formulario para agregar fallecido -->
        <div class="card mb-4">
            <div class="card-header text-center bg-primary text-white">
                <h4 class="mb-0"><i class="fas fa-plus-circle"></i> Agregar Fallecido</h4>
            </div>
            <div class="card-body">
                <form method="post" action="{% url 'agregarFallecido' %}">
                    {% csrf_token %}

                    <h5 class="text-primary mb-3"><i class="fas fa-user"></i> Datos del Fallecido</h5>

                    <!-- Fila 1: RUT, Primer Nombre, Segundo Nombre, Apellido Paterno -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-3">
                            <label for="rut" class="form-label">RUT *</label>
                            <input type="text" class="form-control campo-input" id="rut" name="rut"
                                placeholder="12.345.678-9" required>
                        </div>
                        <div class="col-md-3">
                            <label for="nombre" class="form-label">Primer Nombre *</label>
                            <input type="text" class="form-control campo-input" id="nombre" name="nombre"
                                placeholder="Primer Nombre" pattern="[A-Za-z谩茅铆贸煤帽\s]+"
                                title="Solo letras y espacios" oninput="this.value = this.value.toUpperCase()" required>
                        </div>
                        <div class="col-md-3">
                            <label for="segundo_nombre" class="form-label">Segundo Nombre</label>
                            <input type="text" class="form-control campo-input" id="segundo_nombre"
                                name="segundo_nombre" placeholder="Segundo Nombre (opcional)"
                                pattern="[A-Za-z谩茅铆贸煤帽\s]+" title="Solo letras y espacios"
                                oninput="this.value = this.value.toUpperCase()">
                        </div>
                        <div class="col-md-3">
                            <label for="apellido_p" class="form-label">Apellido Paterno *</label>
                            <input type="text" class="form-control campo-input" id="apellido_p" name="apellido_p"
                                placeholder="Apellido Paterno" pattern="[A-Za-z谩茅铆贸煤帽\s]+"
                                title="Solo letras y espacios" oninput="this.value = this.value.toUpperCase()" required>
                        </div>
                    </div>

                    <!-- Fila 2: Apellido Materno, Fecha, Ubicaci贸n, Maps -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <label for="apellido_m" class="form-label">Apellido Materno *</label>
                            <input type="text" class="form-control campo-input" id="apellido_m" name="apellido_m"
                                placeholder="Apellido Materno" pattern="[A-Za-z谩茅铆贸煤帽\s]+"
                                title="Solo letras y espacios" oninput="this.value = this.value.toUpperCase()" required>
                        </div>
                        <div class="col-md-3">
                            <label for="fechafallecimiento" class="form-label">Fecha Fallecimiento *</label>
                            <input type="date" class="form-control campo-input" id="fechafallecimiento"
                                name="fechafallecimiento" required>
                        </div>
                        <div class="col-md-3">
                            <label for="ubicacion" class="form-label">Ubicaci贸n *</label>
                            <select class="form-control campo-input" id="ubicacion" name="ubicacion" required>
                                <option value="">Seleccione ubicaci贸n</option>
                                <option value="sotano">S贸tano</option>
                                <option value="bloque_1">Bloque 1</option>
                                <option value="bloque_2">Bloque 2</option>
                                <option value="miramar">Miramar</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="maps" class="form-label">Google Maps</label>
                            <input type="url" class="form-control campo-input" id="maps" name="maps"
                                placeholder="https://maps.google.com/...">
                        </div>
                    </div>

                    <hr>
                    <h5 class="text-success mb-3"><i class="fas fa-users"></i> Datos del Familiar Responsable</h5>

                    <!-- Fila 3: Datos del Familiar -->
                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <label for="nombre_familiar" class="form-label">Nombre Completo *</label>
                            <input type="text" class="form-control campo-input" id="nombre_familiar"
                                name="nombre_familiar" placeholder="Nombre del familiar" required>
                        </div>
                        <div class="col-md-3">
                            <label for="email_familiar" class="form-label">Email</label>
                            <input type="email" class="form-control campo-input" id="email_familiar"
                                name="email_familiar" placeholder="correo@ejemplo.com">
                        </div>
                        <div class="col-md-3">
                            <label for="telefono_familiar" class="form-label">Tel茅fono *</label>
                            <input type="tel" class="form-control campo-input" id="telefono_familiar"
                                name="telefono_familiar" placeholder="+56 9 1234 5678" required>
                        </div>
                        <div class="col-md-2">
                            <label for="parentesco" class="form-label">Parentesco *</label>
                            <select class="form-control campo-input" id="parentesco" name="parentesco" required>
                                <option value="">Seleccione</option>
                                <option value="hijo">Hijo/a</option>
                                <option value="esposo">Esposo/a</option>
                                <option value="padre">Padre/Madre</option>
                                <option value="hermano">Hermano/a</option>
                                <option value="nieto">Nieto/a</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>
                    </div>

                    <!-- Botones -->
                    <div class="row">
                        <div class="col-md-12 d-flex justify-content-end gap-2">
                            <button type="reset" class="btn btn-outline-secondary"><i class="fas fa-eraser"></i>
                                Limpiar</button>
                            <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Guardar
                                Fallecido</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tabla de fallecidos -->
        {% if fallecidos %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>RUT</th>
                        <th>Nombre</th>
                        <th>Apellido P</th>
                        <th>Apellido M</th>
                        <th>Fecha Fallecimiento</th>
                        <th>Ubicaci贸n</th>
                        <th>Maps</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fallecido in fallecidos %}
                    <tr>
                        <td>{{ fallecido.rut }}</td>
                        <td>{% if fallecido.segundo_nombre %}{{ fallecido.nombre }} {{ fallecido.segundo_nombre }}{%
                            else %}{{ fallecido.nombre }}{% endif %}</td>
                        <td>{{ fallecido.apellido_p }}</td>
                        <td>{{ fallecido.apellido_m }}</td>
                        <td>{{ fallecido.fechafallecimiento|date:"d-m-Y" }}</td>
                        <td>{{ fallecido.ubicacion }}</td>
                        <td>
                            {% if fallecido.latitud and fallecido.longitud %}
                            <a href="{% url 'mapa_tumba' fallecido.id %}" class="btn btn-sm btn-info" title="Ver Mapa">
                                <i class="fas fa-map-marked-alt"></i>
                            </a>
                            {% elif fallecido.maps %}
                            <a href="{{ fallecido.maps }}" target="_blank" class="btn btn-sm btn-info"
                                title="Google Maps">
                                <i class="fas fa-map-marker-alt"></i>
                            </a>
                            {% else %}
                            <span class="text-muted">N/A</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal"
                                data-id="{{ fallecido.id }}" data-rut="{{ fallecido.rut }}"
                                data-nombre="{{ fallecido.nombre }}"
                                data-segundo_nombre="{{ fallecido.segundo_nombre }}"
                                data-apellido_p="{{ fallecido.apellido_p }}"
                                data-apellido_m="{{ fallecido.apellido_m }}"
                                data-fechafallecimiento="{{ fallecido.fechafallecimiento|date:'Y-m-d' }}"
                                data-ubicacion="{{ fallecido.ubicacion }}" data-maps="{{ fallecido.maps }}"
                                data-latitud="{{ fallecido.latitud }}" data-longitud="{{ fallecido.longitud }}"
                                data-nombre_familiar="{{ fallecido.nombre_familiar }}"
                                data-email_familiar="{{ fallecido.email_familiar }}"
                                data-telefono_familiar="{{ fallecido.telefono_familiar }}"
                                data-parentesco="{{ fallecido.parentesco }}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <a href="{% url 'eliminarFallecido' fallecido.id %}" class="btn btn-danger btn-sm"
                                onclick="return confirm('驴Est谩 seguro de eliminar este registro?')">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info text-center" role="alert">
            <i class="fas fa-info-circle"></i> <strong>No se encontraron resultados en el sistema</strong>
        </div>
        {% endif %}
    </div>

    <script>
        // Auto-ocultar mensajes despu茅s de 5 segundos
        setTimeout(() => {
            const messageContainer = document.getElementById('message-container');
            if (messageContainer) {
                messageContainer.style.transition = "opacity 1s ease";
                messageContainer.style.opacity = "0";
                setTimeout(() => messageContainer.remove(), 1000);
            }
        }, 5000);
    </script>

    <!-- Modal de Edici贸n -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title" id="editModalLabel"><i class="fas fa-edit"></i> Editar Fallecido</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="post" action="{% url 'actualizarFallecido' id=0 %}" id="editForm">
                    {% csrf_token %}
                    <input type="hidden" name="id" id="edit-id">
                    <div class="modal-body">
                        <h6 class="text-primary mb-3"><i class="fas fa-user"></i> Datos del Fallecido</h6>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-rut" class="form-label">RUT</label>
                                <input type="text" class="form-control campo-input" id="edit-rut" name="rut" required>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-nombre" class="form-label">Primer Nombre</label>
                                <input type="text" class="form-control campo-input" id="edit-nombre" name="nombre"
                                    required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-segundo_nombre" class="form-label">Segundo Nombre</label>
                                <input type="text" class="form-control campo-input" id="edit-segundo_nombre"
                                    name="segundo_nombre">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-apellido_p" class="form-label">Apellido Paterno</label>
                                <input type="text" class="form-control campo-input" id="edit-apellido_p"
                                    name="apellido_p" required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-apellido_m" class="form-label">Apellido Materno</label>
                                <input type="text" class="form-control campo-input" id="edit-apellido_m"
                                    name="apellido_m" required>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-fechafallecimiento" class="form-label">Fecha Fallecimiento</label>
                                <input type="date" class="form-control campo-input" id="edit-fechafallecimiento"
                                    name="fechafallecimiento" required>
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-ubicacion" class="form-label">Ubicaci贸n</label>
                                <select class="form-control campo-input" id="edit-ubicacion" name="ubicacion" required>
                                    <option value="">Seleccione ubicaci贸n</option>
                                    <option value="sotano">S贸tano</option>
                                    <option value="bloque_1">Bloque 1</option>
                                    <option value="bloque_2">Bloque 2</option>
                                    <option value="miramar">Miramar</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-maps" class="form-label">Google Maps</label>
                                <input type="text" class="form-control campo-input" id="edit-maps" name="maps"
                                    placeholder="https://maps.google.com/...">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-12">
                                <label for="edit-maps" class="form-label">Google Maps (URL)</label>
                                <input type="text" class="form-control campo-input" id="edit-maps" name="maps"
                                    placeholder="https://maps.google.com/...">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-latitud" class="form-label">Latitud</label>
                                <input type="text" class="form-control campo-input" id="edit-latitud" name="latitud"
                                    placeholder="-33.0472">
                                <small class="text-muted">Ejemplo: -33.0472</small>
                            </div>
                            <div class="col-md-6">
                                <label for="edit-longitud" class="form-label">Longitud</label>
                                <input type="text" class="form-control campo-input" id="edit-longitud" name="longitud"
                                    placeholder="-71.6127">
                                <small class="text-muted">Ejemplo: -71.6127</small>
                            </div>
                        </div>

                        <hr>
                        <h6 class="text-success mb-3"><i class="fas fa-users"></i> Datos del Familiar</h6>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-nombre_familiar" class="form-label">Nombre del Familiar</label>
                                <input type="text" class="form-control campo-input" id="edit-nombre_familiar"
                                    name="nombre_familiar">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-email_familiar" class="form-label">Email</label>
                                <input type="email" class="form-control campo-input" id="edit-email_familiar"
                                    name="email_familiar">
                            </div>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label for="edit-telefono_familiar" class="form-label">Tel茅fono</label>
                                <input type="tel" class="form-control campo-input" id="edit-telefono_familiar"
                                    name="telefono_familiar">
                            </div>
                            <div class="col-md-6">
                                <label for="edit-parentesco" class="form-label">Parentesco</label>
                                <select class="form-control campo-input" id="edit-parentesco" name="parentesco">
                                    <option value="">Seleccione</option>
                                    <option value="hijo">Hijo/a</option>
                                    <option value="esposo">Esposo/a</option>
                                    <option value="padre">Padre/Madre</option>
                                    <option value="hermano">Hermano/a</option>
                                    <option value="nieto">Nieto/a</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i
                                class="fas fa-times"></i> Cerrar</button>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar
                            Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Script para llenar el modal con los datos del fallecido -->
    <script>
        const editModal = document.getElementById('editModal');
        editModal.addEventListener('show.bs.modal', event => {
            const button = event.relatedTarget;
            const fallecidoId = button.getAttribute('data-id');

            document.getElementById('edit-id').value = fallecidoId;
            document.getElementById('editForm').action = `{% url 'actualizarFallecido' 0 %}`.replace('0', fallecidoId);

            document.getElementById('edit-rut').value = button.getAttribute('data-rut');
            document.getElementById('edit-nombre').value = button.getAttribute('data-nombre');
            document.getElementById('edit-segundo_nombre').value = button.getAttribute('data-segundo_nombre') || '';
            document.getElementById('edit-apellido_p').value = button.getAttribute('data-apellido_p');
            document.getElementById('edit-apellido_m').value = button.getAttribute('data-apellido_m');

            const fechafallecimiento = button.getAttribute('data-fechafallecimiento');
            document.getElementById('edit-fechafallecimiento').value = fechafallecimiento || '';

            document.getElementById('edit-ubicacion').value = button.getAttribute('data-ubicacion');
            document.getElementById('edit-maps').value = button.getAttribute('data-maps');
            document.getElementById('edit-latitud').value = button.getAttribute('data-latitud') || '';
            document.getElementById('edit-longitud').value = button.getAttribute('data-longitud') || '';

            // Datos del familiar
            document.getElementById('edit-nombre_familiar').value = button.getAttribute('data-nombre_familiar') || '';
            document.getElementById('edit-email_familiar').value = button.getAttribute('data-email_familiar') || '';
            document.getElementById('edit-telefono_familiar').value = button.getAttribute('data-telefono_familiar') || '';
            document.getElementById('edit-parentesco').value = button.getAttribute('data-parentesco') || '';
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <!-- Script para formatear y validar RUT chileno -->
    <script>
        // Funci贸n para formatear RUT autom谩ticamente
        function formatearRUT(rut) {
            rut = rut.replace(/[^\dkK]/g, '');
            if (rut.length === 0) return '';
            let cuerpo = rut.slice(0, -1);
            let dv = rut.slice(-1).toUpperCase();
            cuerpo = cuerpo.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            if (cuerpo.length > 0) {
                return cuerpo + '-' + dv;
            }
            return dv;
        }

        function validarRUT(rut) {
            rut = rut.replace(/[^\dkK]/g, '');
            if (rut.length < 2) return false;
            let cuerpo = rut.slice(0, -1);
            let dv = rut.slice(-1).toUpperCase();
            let suma = 0;
            let multiplo = 2;
            for (let i = cuerpo.length - 1; i >= 0; i--) {
                suma += multiplo * parseInt(cuerpo.charAt(i));
                multiplo = multiplo < 7 ? multiplo + 1 : 2;
            }
            let dvEsperado = 11 - (suma % 11);
            dvEsperado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();
            return dv === dvEsperado;
        }

        function aplicarFormatoRUT(input) {
            input.addEventListener('input', function (e) {
                let cursorPos = this.selectionStart;
                let valorAnterior = this.value;
                this.value = formatearRUT(this.value);
                if (this.value.length > valorAnterior.length) {
                    cursorPos++;
                }
                this.setSelectionRange(cursorPos, cursorPos);
            });

            input.addEventListener('blur', function () {
                if (this.value && !validarRUT(this.value)) {
                    this.classList.add('is-invalid');
                    if (!this.nextElementSibling || !this.nextElementSibling.classList.contains('invalid-feedback')) {
                        let errorMsg = document.createElement('div');
                        errorMsg.className = 'invalid-feedback';
                        errorMsg.textContent = 'RUT inv谩lido';
                        this.parentNode.appendChild(errorMsg);
                    }
                } else {
                    this.classList.remove('is-invalid');
                    if (this.nextElementSibling && this.nextElementSibling.classList.contains('invalid-feedback')) {
                        this.nextElementSibling.remove();
                    }
                }
            });

            input.addEventListener('focus', function () {
                this.classList.remove('is-invalid');
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const rutInput = document.getElementById('rut');
            if (rutInput) aplicarFormatoRUT(rutInput);
            const editRutInput = document.getElementById('edit-rut');
            if (editRutInput) aplicarFormatoRUT(editRutInput);
            const filtroRutInputs = document.querySelectorAll('input[name="rut"]');
            filtroRutInputs.forEach(input => aplicarFormatoRUT(input));
        });

        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function (e) {
                const rutInputs = this.querySelectorAll('input[name="rut"]');
                let rutValido = true;
                rutInputs.forEach(input => {
                    if (input.value && !validarRUT(input.value)) {
                        e.preventDefault();
                        input.classList.add('is-invalid');
                        if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('invalid-feedback')) {
                            let errorMsg = document.createElement('div');
                            errorMsg.className = 'invalid-feedback';
                            errorMsg.textContent = 'RUT inv谩lido';
                            input.parentNode.appendChild(errorMsg);
                        }
                        rutValido = false;
                    }
                });
                if (!rutValido) {
                    alert('Por favor, corrija los RUTs inv谩lidos antes de continuar.');
                }
            });
        });
    </script>
</body>
<footer>
    {% include "includes/footer.html" %}
</footer>

</html>